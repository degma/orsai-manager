{% extends "base.html" %}
{% block content %}
  <div class="d-flex align-items-center justify-content-between mb-3">
    <h1 class="h4 mb-0">Match details</h1>
    <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('matches.list_matches') }}">Back</a>
  </div>

  <div class="card border-0 mb-3">
    <div class="card-body">
      <div class="d-flex align-items-center justify-content-between">
        <h2 class="h5 mb-0">{{ match.opponent }}</h2>
        <span class="badge text-bg-light">{{ match.date }}</span>
      </div>
      <div class="text-muted small mt-1">
        {{ match.season.year }} {{ match.season.term }} - {{ match.season.tournament.name }}
      </div>
      <div class="d-flex align-items-center gap-2 mt-3">
        <span class="badge text-bg-primary">{{ match.our_score }} - {{ match.their_score }}</span>
        <span class="badge text-bg-secondary text-uppercase">{{ match.status }}</span>
      </div>
      <div class="mt-3 small text-muted">
        Location: {{ match.location or 'TBD' }}
      </div>
    </div>
  </div>

  {% if match.notes %}
    <div class="card border-0 mb-3">
      <div class="card-body">
        <h3 class="h6">Notes</h3>
        <p class="mb-0">{{ match.notes }}</p>
      </div>
    </div>
  {% endif %}

  <div class="card border-0 mb-3">
    <div class="card-body">
      <h3 class="h6">My stats</h3>
      {% if not voter_player_id %}
        <p class="text-muted mb-0">Your user is not linked to a player.</p>
      {% elif my_stat %}
        <ul class="list-group list-group-flush">
          <li class="list-group-item px-0 d-flex justify-content-between"><span>Played</span><span>{{ 'Yes' if my_stat.played else 'No' }}</span></li>
          <li class="list-group-item px-0 d-flex justify-content-between"><span>Goals</span><span>{{ my_stat.goals }}</span></li>
          <li class="list-group-item px-0 d-flex justify-content-between"><span>Yellow cards</span><span>{{ my_stat.yellow_cards }}</span></li>
          <li class="list-group-item px-0 d-flex justify-content-between"><span>Red cards</span><span>{{ my_stat.red_cards }}</span></li>
        </ul>
      {% else %}
        <p class="text-muted mb-0">No stats recorded yet.</p>
      {% endif %}
    </div>
  </div>

  <div class="card border-0 mb-3">
    <div class="card-body">
      <h3 class="h6">MVP voting</h3>
      {% if not voter_player_id %}
        <p class="text-muted mb-0">Your user is not linked to a player, so you cannot vote.</p>
      {% else %}
        {% if current_vote %}
          <p class="mb-2">You voted for: {{ current_vote.voted_player.last_name }}, {{ current_vote.voted_player.first_name }}</p>
          <a class="btn btn-sm btn-outline-primary" href="{{ url_for('matches.vote', match_id=match.id) }}">Update my vote</a>
        {% else %}
          <p class="mb-2">You have not voted yet.</p>
          <a class="btn btn-sm btn-primary" href="{{ url_for('matches.vote', match_id=match.id) }}">Vote now</a>
        {% endif %}
      {% endif %}
    </div>
  </div>

  <div class="card border-0">
    <div class="card-body">
      <h3 class="h6">MVP results</h3>
      {% if match.status == 'played' %}
        {% if mvp_results %}
          <ul class="list-group list-group-flush">
            {% for player, count in mvp_results %}
              <li class="list-group-item px-0 d-flex justify-content-between">
                <span>{{ player.last_name }}, {{ player.first_name }}</span>
                <span>{{ count }} votes</span>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted mb-0">No votes yet.</p>
        {% endif %}
      {% else %}
        <p class="text-muted mb-0">MVP results will be available after the match is marked as played.</p>
      {% endif %}
    </div>
  </div>
{% endblock %}
